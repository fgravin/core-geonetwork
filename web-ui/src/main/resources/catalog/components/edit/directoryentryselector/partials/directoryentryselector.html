<!--
  ~ Copyright (C) 2001-2016 Food and Agriculture Organization of the
  ~ United Nations (FAO-UN), United Nations World Food Programme (WFP)
  ~ and United Nations Environment Programme (UNEP)
  ~
  ~ This program is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation; either version 2 of the License, or (at
  ~ your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but
  ~ WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  ~ General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program; if not, write to the Free Software
  ~ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  ~
  ~ Contact: Jeroen Ticheler - FAO - Viale delle Terme di Caracalla 2,
  ~ Rome - Italy. email: geonetwork@osgeo.org
  -->

<span data-ng-search-form="">
  <div class="input-group">
    <div class="input-group-btn">
      <span data-ng-show="templateAddAction"
            data-ng-transclude=""></span>

      <button class="btn btn-default" type="button"
              data-ng-show="popupAction"
              data-ng-click="openSelector()">
        <i class="fa fa-search"/>&nbsp;
        <span data-ng-hide="searchAction">
          {{('searchA' + templateType) | translate}}
        </span>
      </button>
    </div>

    <input type="text" class="form-control"
           placeholder="{{('searchA' + templateType) | translate}}"
           data-ng-show="searchAction"
           data-ng-model="searchObj.params.any"
           data-ng-model-options="modelOptions"
           data-ng-change="triggerSearch()"/>

    <!-- The autocomplete list -->
    <div class="list-group tt-dropdown-menu gn-autocomplete-list"
        data-ng-show="searchResults.records.length > 0">
      <span class="tt-suggestions">
        <div class="tt-suggestion"
            data-ng-repeat="r in searchResults.records"> {{r.title}}
          <span class="pull-right">
            <!-- Add action for simple subtemplates -->
            <div class="btn btn-default"
                 data-ng-hide="isContact"
                  data-ng-click="addEntry(r)">
              <i class="fa fa-plus"></i>
              <!-- TODO: Add with XLink mode -->
            </div>

            <!-- Add action for contact with predefined contact role -->
            <div class="btn btn-default"
                 data-ng-show="isContact && !hasDynamicVariable"
                 data-ng-click="addEntry(r)">
              <i class="fa fa-plus"></i>
            </div>

            <!-- Add action for contact which allows to select contact role -->
            <div class="btn-group"
                 data-ng-show="isContact && hasDynamicVariable"
                 title="{{'addContactAsText-help' | translate}}">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-plus"></i>&nbsp;<span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li data-ng-repeat="role in roles" data-ng-hide="role['@hideInEditMode']">
                  <a href="" data-ng-click="addEntry(r, role.code)" title="{{role.description}}">
                    {{role.label}}
                  </a>
                </li>
              </ul>
            </div>
            <div data-ng-show="gnConfig[gnConfig.key.isXLinkEnabled]"
                 title="{{'addContactAsLink-help' | translate}}"
                 class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-link"></i>&nbsp;<span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li data-ng-repeat="role in roles" data-ng-hide="role['@hideInEditMode']">
                  <a href="" data-ng-click="addEntry(r, role.code, true)" title="{{role.description}}">
                    {{role.label}}
                  </a>
                </li>
              </ul>
            </div>
          </span>
          <div class="clearfix"></div>
        </div>
      </span>
    </div>

    <div class="input-group-btn">
      <button class="btn btn-default" type="button"
              data-ng-show="searchResults.records.length != 0"
              data-ng-click="searchResults.records = []">
        <i class="fa fa-times"></i>
        <span>&nbsp;</span>
      </button>
    </div>

    <!-- The contact to insert once received -->
    <div data-ng-if="snippet">
      <input name="{{snippetRef}}" type="hidden" value="{{snippet}}"/>
    </div>
  </div>

</span>
